"use strict";(()=>{var e={};e.id=516,e.ids=[516],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},5166:e=>{e.exports=require("mammoth")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},4193:e=>{e.exports=require("pdf-parse")},5377:e=>{e.exports=require("tesseract.js")},8893:e=>{e.exports=require("buffer")},2079:e=>{e.exports=import("openai")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},8960:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{config:()=>p,default:()=>u,routeModule:()=>c});var s=a(1802),n=a(7153),o=a(6249),i=a(7907),l=e([i]);i=(l.then?(await l)():l)[0];let u=(0,o.l)(i,"default"),p=(0,o.l)(i,"config"),c=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/analyze",pathname:"/api/analyze",bundlePath:"",filename:""},userland:i});r()}catch(e){r(e)}})},7907:(e,t,a)=>{a.a(e,async(e,r)=>{try{a.r(t),a.d(t,{default:()=>m});var s=a(2885),n=a(5377),o=a.n(n),i=a(4193),l=a.n(i),u=a(5166),p=a.n(u),c=a(2079),f=a(8893),d=e([c]);c=(d.then?(await d)():d)[0];let A=(0,s.createClient)("https://rssjlrfmltlkpiwpctht.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY),P=new c.OpenAI({apiKey:process.env.OPENAI_API_KEY});async function m(e,t){let{filePath:a}=e.body;if(!a)return t.status(400).json({error:"Missing filePath"});try{let{data:e,error:r}=await A.storage.from("documents").download(a);if(r||!e)throw Error("Failed to download file.");let s=a.split(".").pop()?.toLowerCase(),n=await e.arrayBuffer(),i=f.Buffer.from(n),u="";if("pdf"===s)u=(await l()(i)).text;else if("docx"===s)u=(await p().extractRawText({buffer:i})).value;else if(["png","jpg","jpeg"].includes(s||""))u=(await o().recognize(i,"eng")).data.text;else throw Error("Unsupported file type.");if(!u||u.trim().length<10)throw Error("Could not extract text from the file.");let c=`You are a legal assistant. Analyze the following legal document text:

"${u}"

Please provide:
1. A concise summary.
2. The most important clauses (as a bullet list).
3. A simple explanation suitable for a layperson.`,d=await P.chat.completions.create({model:"gpt-4",messages:[{role:"user",content:c}]}),m=d.choices[0].message?.content||"",h=m.match(/summary[\s\S]*?:([\s\S]*?)(?:\n\d\.|$)/i),g=m.match(/clauses[\s\S]*?:([\s\S]*?)(?:\n\d\.|$)/i),x=m.match(/explanation[\s\S]*?:([\s\S]*)/i),y=h?.[1]?.trim()||"",w=g?.[1]?.trim()||"",E=x?.[1]?.trim()||"",S=w.split(/\n\s*[-*â€¢\d.]+\s*/).map(e=>e.trim()).filter(Boolean);t.status(200).json({summary:y||"N/A",clauses:S.length?S:[w||"N/A"],explanation:E||"N/A"})}catch(e){console.error("Analysis error:",e.message),t.status(500).json({error:"Analysis failed. "+e.message})}}r()}catch(e){r(e)}})},7153:(e,t)=>{var a;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},1802:(e,t,a)=>{e.exports=a(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=t(t.s=8960);module.exports=a})();